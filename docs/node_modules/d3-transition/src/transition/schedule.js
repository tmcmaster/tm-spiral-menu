define(["exports","../../../d3-dispatch/index.js","../../../d3-timer/index.js"],function(_exports,_index,_index2){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.default=_default;_exports.init=function(node,id){var schedule=node.__transition;if(!schedule||!(schedule=schedule[id])||schedule.state>CREATED)throw new Error("too late");return schedule};_exports.set=function(node,id){var schedule=node.__transition;if(!schedule||!(schedule=schedule[id])||schedule.state>STARTING)throw new Error("too late");return schedule};_exports.get=function(node,id){var schedule=node.__transition;if(!schedule||!(schedule=schedule[id]))throw new Error("too late");return schedule};_exports.ENDED=_exports.ENDING=_exports.STARTED=_exports.STARTING=_exports.SCHEDULED=_exports.CREATED=void 0;var emptyOn=(0,_index.dispatch)("start","end","interrupt"),emptyTween=[],CREATED=0;_exports.CREATED=CREATED;var SCHEDULED=1;_exports.SCHEDULED=SCHEDULED;var STARTING=2;_exports.STARTING=STARTING;var STARTED=3;_exports.STARTED=STARTED;var ENDING=4;_exports.ENDING=ENDING;var ENDED=5;_exports.ENDED=ENDED;function _default(node,name,id,index,group,timing){var schedules=node.__transition;if(!schedules)node.__transition={};else if(id in schedules)return;create(node,id,{name:name,index:index,group:group,on:emptyOn,tween:emptyTween,time:timing.time,delay:timing.delay,duration:timing.duration,ease:timing.ease,timer:null,state:CREATED})}function create(node,id,self){var schedules=node.__transition,tween;schedules[id]=self;self.timer=(0,_index2.timer)(function(elapsed){self.state=SCHEDULED;if(self.delay<=elapsed)start(elapsed-self.delay);else self.timer.restart(start,self.delay,self.time)},0,self.time);function start(elapsed){var i,j,n,o;for(i in schedules){o=schedules[i];if(o.name!==self.name)continue;if(o.state===STARTED){o.state=ENDED;o.timer.stop();o.on.call("interrupt",node,node.__data__,o.index,o.group);delete schedules[i]}else if(+i<id){o.state=ENDED;o.timer.stop();delete schedules[i]}}(0,_index2.timeout)(function(){if(self.state===STARTED){self.timer.restart(tick,self.delay,self.time);tick(elapsed)}});self.state=STARTING;self.on.call("start",node,node.__data__,self.index,self.group);if(self.state!==STARTING)return;self.state=STARTED;tween=Array(n=self.tween.length);for(i=0,j=-1;i<n;++i){if(o=self.tween[i].value.call(node,node.__data__,self.index,self.group)){tween[++j]=o}}tween.length=j+1}function tick(elapsed){var t=elapsed<self.duration?self.ease.call(null,elapsed/self.duration):(self.state=ENDING,1),i=-1,n=tween.length;while(++i<n){tween[i].call(null,t)}if(self.state===ENDING){self.state=ENDED;self.timer.stop();self.on.call("end",node,node.__data__,self.index,self.group);for(i in schedules)if(+i!==id)return void delete schedules[id];delete node.__transition}}}});